# 20210129
## 오늘 한 일
[ 서버 코드리뷰 ]
GetMapping 이런거 할 때 중복되면 안됐었음;;

[ 한 일 ]
희중님 소스랑 연결
리퀘스트에 필요없는 애들 지우기. ( create, update 차이에 따른 별도처리는 고민 해봐야할듯.. )
API 채널 영상 받기. 
API 연관영상 (어떻게 섞을지 몰라서 그냥 다 보내놓음. 클라이언트에서 섞을수 있게).
API 구독 채널 리스트 페이징.
API 채널 영상 페이징. (연관영상 페이징은 어떻게 섞나, 본 거 처리는 어떻게 하나 처리 한 후 할것. )
API 구독한 채널들의 영상들…!! + 페이징
캐싱 구독한 채널들의 영상들 리스트
캐싱 채널의 영상 리스트
캐싱 쿠폰 리스트


[ 가서 해야할일 ]
프로젝트 동기화 ㅠㅠ - 굳
가서 save나 getOne 결과 null 되는걸로 끼워맞추고 예외처리 되는지 확인.
페이징 입력변수 잘 되는지 확인 - 굳
내가 구독한 채널들의 영상들 조인 잘 됐는지 확인. - 쿼리 문제임 조졌따
LAZY, CREATE도 join 일어나는지 쿼리문 확인 - ㄴㄴ안됨 좋네..
클라이언트에 연결

엔티티 날짜 관련 어노테이션 넣기
new만들어서 하는 작업 없애기
리퀘스트에 생성날, 수정날 없애기


@EntityListeners(AuditingEntityListener.class) 
@CreatedDate
@LastModifiedDate
리포지토리와 반응했을 때 날짜를 넣어주는 어노테이션

얘들이 날짜 만들어주는 어노테이션...
엔티티에 저거 해주고,
리포지토리.save 반환값을 리턴해야 날짜가 제대로 나옴.
반환값이 아니면 날짜 null;


[ 질문거리 정리 ]
관련 영상 -
관련 영상을 만들때는 채널 + 홍보인데, 이 둘을 어떻게 섞어야 하는가?
섞는 작업은 서버에서 하는게 좋은가, 클라에서 하는게 좋은가?
관련 영상에서 이미 본 영상들은 배제시키는 것은  어떻게 처리해야하는가?
이미 보았다는 정보는 서버에 저장해야하는가 디바이스에 저장해야하는가?

JPA 관계 매핑 -
JPA의 관계 매핑이 왜 필요한지 모르겠다. 매핑 안하고 하는게 구현하지 못할것도 없고,
오히려 관계 매핑때문에 단순 create 작업에서 sava가 내부적으로 Select를 한번 하기때문에 필요없는 조인을 해버리곤 한다.
지금 JPA 관계 매핑에서, EAZER로 즉시로딩하면, 비즈니스 로직에서 필요없는 관련 객체들을 로딩하는 발생하는 리소스 낭비가 커서, 글로벌 로딩 전략이 LAZY인데..

매핑, LAZY 처리, Transactional처리, 프록시 및 영속성에 대한 이해,
무한 참조에 따른 결과값 예외 처리,
손해가 많음..;

매핑 안하고 그냥 하기
연관 객체가 필요없을 때 = 평소대로 하면 됨.
연관 객체가 필요할 때 = 직접 쿼리문을 작성하면 됨.

매핑 하고 하기
연관 객체가 필요없을 때 = 평소대로 하면 됨.
연관 객체가 필요할 때 = fetch join 쿼리문을 작성하면 됨.

..? 무슨 이득?

캐싱 -
사용성이 정말 많은데, 정확도도 중요한 것들은 캐싱을 해야하는가..? 별도의 장치가 있는가?
예를들어 쿠폰이나 채널의 영상 리스트는 새로운 것에 대한 정확도는 그리 안높아도 되니까 캐싱을 적용했는데,
내 구독 채널 리스트는 내가 구독하거나 구독 취소한 결과가 바로 반영되어야 하지만, 사용성이 매우 높고, 비슷한 데이터인 경우가 매우 많아서 고민이 된다.

[ 코드리뷰 리뷰 ]
- 관계 매핑
=> 관계 매핑의 사전 작업들에서 얻는 불편함보다, DB가 복잡해졌을 때 연관 객체를 쉽게 얻는 편리함이 더 크다!

- 캐싱
사용성과 중복성, 유효성도 높은 경우 캐싱 가능한가?
=> 업데이트마다 캐시를 지우는 방식 찾아보기

- 관련 영상
=> 섞는 작업과 이미 본 영상을 배제하는 작업 모두 서버에서 하는게 일반적이다.

- PK
=> 일부 객체는 필요없는 개인키를 넣는다고 해도, 엔티티의 정형화를 통해 얻을 수 있는 이득이 많기 때문에
그냥 넣어도 상관없다! 성능과 편리함 사이에서 상황에따라 선택할 수 있는 부분이다!


- 해야할 것
1. 프로젝트 이름, 패키지 구조 등 완전 kkpoint용으로 갈아엎기! - 완료
2. 서비스에 있는 애들 전부 @트랜젝셔널 넣기! R전용은 트랜잭셔널 리드온리 하기!
=> 마스터 레플리카 구조에서, 보일러 플레이트 코드 없이, 서버를 알아서 구분해줌
3. 디비에서 객체 가져올때 오류 별도로 처리해주기! (윗단계에서 캐치, 처리, 로그(IP등))

- 알게된 것
1. 요즘 캐시, 통신 등 모두 JSON으로 시리얼라이즈 -> 통신 -> 디시리얼라이즈 하는 추세.
2. 레디스에 들어있는 캐시 데이터들 셀렉트 해보면 좋을것! (Redis CLI를 사용해서..? ㅇㅇ? ㅇㅋㅇ;ㅋ)
3. 디비 크리티컬 섹션 처리. 쿼리문 뒤에 포 업데이트? 찾아보기 ㅇㅋ
4. 개인키는 클러스터링 인덱스..!!
5. 기존의 푸시는 aws sns(simple noti service)
6. GA(구글 애널리틱스) 미리 넣어도 좋음^^
7. 리퀘-엔티티-리스폰 나눈거 베리 굳!, 쿼리문들 굳!, 빌더 패턴 굳!

[ 유튜브 커스텀 컨트롤 ]


[ 목요일 세미나 준비 ]


[ 프로젝트 소스 정리 ]
프로젝트 메인 


## 일일보고
kkpoint
- 서버 페이징, 캐싱 구현
- 서버 코드 리뷰 및 애매한 사항들 정리
- 서버 레거시 소스 정리

못 올리고 퇴근?

## 민재님 오시면 물어볼거..
[ 네트워크 매니저에 로우 데이터 핸들러 여쭤보기 ]
[ tig 커밋 아이디 보기 ]


